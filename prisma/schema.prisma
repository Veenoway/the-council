// ============================================================
// PRISMA SCHEMA â€” Database models
// ============================================================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================================
// MESSAGES
// ============================================================

model Message {
  id          String   @id @default(uuid())
  botId       String
  content     String
  token       String?
  txHash      String?
  messageType String   @default("chat")
  createdAt   DateTime @default(now())

  @@index([botId])
  @@index([token])
  @@index([createdAt])
}

// ============================================================
// TRADES
// ============================================================

model Trade {
  id           String   @id @default(uuid())
  botId        String
  tokenAddress String
  tokenSymbol  String
  side         String
  amountIn     Float
  amountOut    Float
  price        Float
  txHash       String
  status       String   @default("pending")
  pnl          Float?
  createdAt    DateTime @default(now())

  @@index([botId])
  @@index([tokenAddress])
  @@index([createdAt])
  @@index([status])
}

// ============================================================
// TOKENS
// ============================================================

model Token {
  address        String   @id
  symbol         String
  name           String
  price          Float
  priceChange24h Float    @default(0)
  mcap           Float
  liquidity      Float
  holders        Int
  deployer       String
  verdict        String?
  riskScore      Int?
  analysis       Json?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  image          String?

  @@index([symbol])
  @@index([verdict])
  @@index([createdAt])
}

// ============================================================
// POSITIONS
// ============================================================

model Position {
  id           String    @id @default(uuid())
  botId        String
  tokenAddress String
  tokenSymbol  String
  amount       Float
  entryPrice   Float
  entryTxHash  String
  isOpen       Boolean   @default(true)
  exitPrice    Float?
  exitTxHash   String?
  pnl          Float?
   entryValueMon Float?
  createdAt    DateTime  @default(now())
  closedAt     DateTime?

  @@index([botId, isOpen])
  @@index([tokenAddress])
}

// ============================================================
// BOT STATS â€” All-time stats
// ============================================================

model BotStats {
  botId         String   @id
  totalTrades   Int      @default(0)
  wins          Int      @default(0)
  losses        Int      @default(0)
  winRate       Float    @default(0)
  totalPnl      Float    @default(0)
  currentStreak Int      @default(0)
  bestStreak    Int      @default(0)
  updatedAt     DateTime @updatedAt
}

// ============================================================
// BOT DAILY STATS â€” For leaderboard & betting
// ============================================================

model BotDailyStats {
  id        String   @id @default(uuid())
  botId     String
  date      String
  trades    Int      @default(0)
  wins      Int      @default(0)
  pnl       Float    @default(0)
  volume    Float    @default(0)
  createdAt DateTime @default(now())

  @@unique([botId, date])
  @@index([date])
}

// ============================================================
// BOT WALLETS
// ============================================================

model BotWallet {
  id        String   @id @default(uuid())
  botId     String   @unique
  address   String   @unique
  balance   Float    @default(0)
  updatedAt DateTime @updatedAt

  @@index([botId])
}

model Agent {
  id            String      @id @default(uuid())
  name          String      @unique
  description   String?
  avatar        String      @default("ðŸ¤–")
  color         String      @default("#888888")
  apiKey        String      @unique
  webhookUrl    String?
  walletAddress String?
  messagesCount Int         @default(0)
  votesCount    Int         @default(0)
  tradesCount   Int         @default(0)
  correctVotes  Int         @default(0)
  totalPnl      Decimal     @default(0)
  isActive      Boolean     @default(true)
  isOnline      Boolean     @default(false)
  lastSeenAt    DateTime?
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  votes         AgentVote[]

  @@index([isActive])
  @@index([isOnline])
}

model AgentVote {
  id           String   @id @default(uuid())
  agentId      String
  tokenAddress String
  vote         String
  confidence   Int
  wasCorrect   Boolean?
  createdAt    DateTime @default(now())

  agent        Agent    @relation(fields: [agentId], references: [id])

  @@unique([agentId, tokenAddress])
  @@index([tokenAddress])
}

